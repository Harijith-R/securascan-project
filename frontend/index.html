<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecuraScan - Web Vulnerability Scanner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- PDF & Chart Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .bg-grid {
            background-image: linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 2rem 2rem;
        }
        .card-glow {
            transition: box-shadow 0.3s ease-in-out;
        }
        .card-glow:hover {
            box-shadow: 0 0 25px rgba(79, 70, 229, 0.5);
        }
        .rating-A { background-color: #10B981; color: white; }
        .rating-B { background-color: #F59E0B; color: white; }
        .rating-C { background-color: #EF4444; color: white; }
        .rating-D { background-color: #B91C1C; color: white; }
        .rating-E { background-color: #7F1D1D; color: white; }
        [x-cloak] { display: none !important; }

        /* Modal Styles */
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
        }
        .spinner {
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .signup-field {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
        }
        .signup-field.visible {
            max-height: 100px; /* Adjust as needed */
            opacity: 1;
        }
        #profilePicturePreview {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 50%;
        }

        /* AI Chat Styles */
        .chat-bubble {
            max-width: 80%;
            padding: 10px 16px;
            border-radius: 16px;
        }
        .chat-bubble.user {
            background-color: #4f46e5;
            color: white;
            border-bottom-right-radius: 4px;
        }
        .chat-bubble.ai {
            background-color: #374151;
            color: #e5e7eb;
            border-bottom-left-radius: 4px;
        }

        /* How it works animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .fade-in-up {
            opacity: 0;
            animation: fadeInUp 0.5s ease-out forwards;
        }
        .step-1 { animation-delay: 0.1s; }
        .step-2 { animation-delay: 0.3s; }
        .step-3 { animation-delay: 0.5s; }

    </style>
</head>
<body class="bg-slate-900 text-slate-200 bg-grid">

    <div id="app" class="min-h-screen flex flex-col">

        <!-- Header -->
        <header class="py-4 px-4 md:px-8 border-b border-slate-800 backdrop-blur-sm sticky top-0 z-50">
            <nav class="container mx-auto flex justify-between items-center">
                <a href="#" class="text-2xl font-bold tracking-tighter text-white">Secura<span class="text-indigo-400">Scan</span></a>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#features" class="hover:text-indigo-400 transition-colors">Features</a>
                    <a href="#pricing" class="hover:text-indigo-400 transition-colors">Pricing</a>
                    <a href="#about" class="hover:text-indigo-400 transition-colors">About</a>
                    <a href="#blog" class="hover:text-indigo-400 transition-colors">Blog</a>
                    <a href="#faq" class="hover:text-indigo-400 transition-colors">FAQ</a>
                    <div id="user-info" class="hidden items-center space-x-4">
                        <button id="profileBtn" class="flex items-center space-x-2 hover:text-indigo-400 transition-colors">
                            <img id="navProfilePic" src="https://placehold.co/32x32/1e293b/94a3b8?text=U" alt="User" class="w-8 h-8 rounded-full object-cover">
                            <span id="user-display-name" class="text-sm font-semibold"></span>
                        </button>
                        <button id="logoutBtn" class="hover:text-indigo-400 transition-colors text-sm">Log Out</button>
                    </div>
                    <div id="guest-info" class="flex items-center space-x-6">
                        <button id="loginBtnNav" class="hover:text-indigo-400 transition-colors">Log In</button>
                        <button id="signUpBtnNav" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition-transform hover:scale-105">
                            Sign Up Free
                        </button>
                    </div>
                </div>
                 <button class="md:hidden text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </nav>
        </header>

        <main class="flex-grow container mx-auto p-4 md:p-8 flex items-center justify-center">
            <div id="mainContent" class="w-full max-w-4xl text-center">
                
                <!-- Initial View -->
                <section id="initialView">
                    <h1 class="text-4xl md:text-6xl font-extrabold tracking-tighter text-white mb-4">
                        Uncover Your Website's<br> <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400">Security Blind Spots</span>
                    </h1>
                    <p class="text-lg md:text-xl text-slate-400 max-w-2xl mx-auto mb-8">
                        Get a free, non-intrusive security assessment in seconds. Identify passive vulnerabilities and receive your website's security grade.
                    </p>
                    <div class="max-w-2xl mx-auto">
                        <div class="flex flex-col sm:flex-row gap-2 mb-4">
                            <input type="text" id="urlInput" placeholder="https://example.com" class="flex-grow bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                            <button id="scanButton" disabled class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg transition-transform hover:scale-105 flex items-center justify-center space-x-2 w-full sm:w-auto opacity-50 cursor-not-allowed">
                                <svg id="scan-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                                <div id="scan-spinner" class="spinner w-5 h-5 rounded-full border-2 border-white hidden"></div>
                                <span id="scan-button-text">Initializing...</span>
                            </button>
                        </div>
                        <p id="errorMessage" class="text-red-400 h-5 text-sm"></p>
                    </div>
                    <p class="text-xs text-slate-500 mt-4">
                        <span class="font-bold text-amber-400">⚠️ Important:</span> Only scan targets you own or have explicit written permission to test.
                    </p>

                    <!-- Trust Elements -->
                    <div class="mt-12 text-center">
                        <p class="text-sm font-semibold text-slate-400 mb-4">Trusted by 1,000+ site owners and developers</p>
                        <div class="flex justify-center items-center space-x-6 text-xs text-slate-400">
                             <span class="flex items-center space-x-1.5">
                                <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>SSL Secure</span>
                            </span>
                            <span class="flex items-center space-x-1.5">
                                <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>GDPR Safe</span>
                            </span>
                            <span class="flex items-center space-x-1.5">
                                <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>Scan Data Not Stored</span>
                            </span>
                        </div>
                    </div>
                </section>

                <!-- Scanning View -->
                <section id="scanningView" class="hidden">
                    <div class="flex flex-col items-center justify-center space-y-6">
                        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-indigo-400"></div>
                        <h2 class="text-2xl font-semibold text-white">Performing Passive Scan...</h2>
                        <p class="text-slate-400 max-w-md">Your request has been queued. This demo will simulate the completion after a few seconds.</p>
                        <p class="text-slate-500" id="scanningUrl"></p>
                    </div>
                </section>

                <!-- Results View -->
                <section id="resultsView" class="hidden w-full text-left">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-3xl font-bold text-white">Passive Scan Complete</h2>
                        <button id="shareButton" class="flex items-center space-x-2 bg-slate-700 hover:bg-slate-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6.002l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.368a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path></svg>
                            <span>Share</span>
                        </button>
                    </div>
                    
                    <p class="text-slate-400 mb-8" id="scannedUrlResult"></p>
                    <p id="shareSuccessMessage" class="text-green-400 h-5 text-sm mb-4"></p>
                    
                    <div class="grid md:grid-cols-3 gap-8">
                        <!-- Left Column: Rating & SSL -->
                        <div class="md:col-span-1 space-y-8">
                            <!-- Rating Card -->
                            <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 flex flex-col items-center justify-center">
                                <h3 class="text-lg font-semibold text-slate-300 mb-4">Security Rating</h3>
                                <div id="ratingCircle" class="w-32 h-32 rounded-full flex items-center justify-center text-5xl font-extrabold mb-4 transition-all duration-500">
                                    <span id="ratingGrade"></span>
                                </div>
                                <p class="text-sm text-slate-400 text-center">Based on passive security checks.</p>
                            </div>
                            
                            <!-- SSL Card -->
                            <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
                                <h3 class="text-lg font-semibold text-slate-300 mb-4">SSL/TLS Certificate</h3>
                                <ul id="sslDetails" class="space-y-2 text-sm text-slate-300">
                                    <!-- JS will populate this -->
                                </ul>
                            </div>
                        </div>

                        <!-- Right Column: Summary & Next Step -->
                        <div class="md:col-span-2 space-y-8">
                            <!-- AI Summary -->
                            <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
                                <div class="flex justify-between items-center mb-3">
                                    <h3 class="text-xl font-bold text-white">AI Analysis</h3>
                                    <button id="aiSummaryBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm flex items-center space-x-2">
                                        <svg id="ai-summary-icon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707"></path></svg>
                                        <div id="ai-summary-spinner" class="spinner w-4 h-4 rounded-full border-2 border-white hidden"></div>
                                        <span>Analyze with AI</span>
                                    </button>
                                </div>
                                <p id="aiSummaryContent" class="text-slate-400 italic">Click "Analyze with AI" to generate a simple, non-technical summary of your security findings.</p>
                            </div>

                            <!-- Advanced Scan CTA -->
                            <div class="bg-slate-900/70 border-2 border-indigo-500 rounded-xl p-6 card-glow">
                                <h4 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400 mb-2">Ready for the Full Picture?</h4>
                                <p class="text-slate-400 mb-4">Our passive scan only scratches the surface. An advanced scan actively probes for critical vulnerabilities like SQL Injection, XSS, and misconfigurations.</p>
                                <button id="advancedScanBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition-transform hover:scale-105">
                                    Unlock Advanced Scan for $25
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Findings Section -->
                    <div class="mt-12">
                        <h3 class="text-2xl font-bold text-white mb-6">Prioritized Findings</h3>
                        <div id="findingsList" class="space-y-4">
                            <!-- JS will populate this -->
                        </div>
                    </div>
                    
                    <!-- AI Chat -->
                    <div class="mt-12">
                         <h3 class="text-2xl font-bold text-white mb-6">Ask Our AI Assistant</h3>
                         <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-4">
                             <div id="chatWindow" class="h-64 overflow-y-auto mb-4 p-4 space-y-4 bg-slate-900/50 rounded-lg">
                                 <!-- Chat messages will appear here -->
                                 <div class="chat-bubble ai">
                                    Hello! I'm here to help. Ask me anything about your results, like "What is CSRF?" or "How do I fix a missing CSP header?"
                                 </div>
                             </div>
                             <form id="chatForm" class="flex gap-2">
                                 <input type="text" id="chatInput" placeholder="Ask a follow-up question..." class="flex-grow bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                 <button type="submit" id="chatSendBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold p-3 rounded-lg transition-colors">
                                     <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                                 </button>
                             </form>
                         </div>
                    </div>
                    
                    <div class="mt-8 flex flex-col sm:flex-row justify-center items-center gap-4">
                        <button id="downloadPdfBtn" class="bg-slate-700 hover:bg-slate-600 text-white font-semibold py-2 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2 w-72">
                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                             <span>Download PDF Report</span>
                        </button>
                         <button id="scanAgainBtn" class="text-indigo-400 hover:text-indigo-300 font-semibold transition-colors">
                            Scan Another Site
                        </button>
                    </div>
                </section>
            </div>
        </main>
        
        <!-- How It Works Section -->
        <section id="how-it-works" class="py-16 sm:py-24">
            <div class="container mx-auto px-4">
                <div class="text-center max-w-3xl mx-auto">
                    <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight text-white">How It Works</h2>
                    <p class="mt-4 text-lg text-slate-400">Simple, fast, and insightful. Get your report in 3 easy steps.</p>
                </div>
                <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                    <!-- Step 1 -->
                    <div class="fade-in-up step-1 bg-slate-800/50 border border-slate-700 rounded-2xl p-8 text-center">
                        <div class="flex items-center justify-center w-16 h-16 bg-indigo-600 rounded-full mx-auto mb-6 text-2xl font-bold">1</div>
                        <h3 class="text-xl font-bold text-white mb-2">Enter Your URL</h3>
                        <p class="text-slate-400">Provide the public URL of the website you have permission to scan.</p>
                    </div>
                    <!-- Step 2 -->
                    <div class="fade-in-up step-2 bg-slate-800/50 border border-slate-700 rounded-2xl p-8 text-center">
                        <div class="flex items-center justify-center w-16 h-16 bg-indigo-600 rounded-full mx-auto mb-6 text-2xl font-bold">2</div>
                        <h3 class="text-xl font-bold text-white mb-2">Run Passive Scan</h3>
                        <p class="text-slate-400">Our engine performs a non-intrusive check for common misconfigurations.</p>
                    </div>
                    <!-- Step 3 -->
                    <div class="fade-in-up step-3 bg-slate-800/50 border border-slate-700 rounded-2xl p-8 text-center">
                        <div class="flex items-center justify-center w-16 h-16 bg-indigo-600 rounded-full mx-auto mb-6 text-2xl font-bold">3</div>
                        <h3 class="text-xl font-bold text-white mb-2">Get Actionable Report</h3>
                        <p class="text-slate-400">Receive a prioritized report with an AI summary and clear fix guidelines.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="py-16 sm:py-24 bg-slate-900/50">
           <div class="container mx-auto px-4">
                <div class="text-center max-w-3xl mx-auto">
                    <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight text-white">One Tool, Complete Visibility</h2>
                    <p class="mt-4 text-lg text-slate-400">From passive checks to AI-powered remediation, we cover all your bases.</p>
                </div>
                <div class="mt-16 grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                        <h3 class="text-xl font-bold text-white mb-2">Instant Passive Scans</h3>
                        <p class="text-slate-400">Get an immediate security baseline without any intrusive tests. Perfect for a quick check-up.</p>
                    </div>
                    <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                        <h3 class="text-xl font-bold text-white mb-2">Advanced Active Scans</h3>
                        <p class="text-slate-400">Go deeper with scans for SQLi, XSS, and other critical OWASP Top 10 vulnerabilities.</p>
                    </div>
                    <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                        <h3 class="text-xl font-bold text-white mb-2">AI-Powered Summaries</h3>
                        <p class="text-slate-400">Understand your risk in plain English. Our AI analyzes your report so you don't have to.</p>
                    </div>
                    <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                        <h3 class="text-xl font-bold text-white mb-2">Risk Prioritization</h3>
                        <p class="text-slate-400">We show you what's critical, high, medium, and low risk, so you know exactly where to start.</p>
</div>
                    <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                        <h3 class="text-xl font-bold text-white mb-2">AI Remediation Chat</h3>
                        <p class="text-slate-400">Ask our AI assistant *how* to fix an issue and get code snippets and config examples.</p>
                    </div>
                    <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                        <h3 class="text-xl font-bold text-white mb-2">Professional PDF Reports</h3>
                        <p class="text-slate-400">Download detailed, shareable PDF reports to send to your team or clients.</p>
                    </div>
                </div>
           </div>
        </section>

        <!-- Testimonials Section -->
        <section id="testimonials" class="py-16 sm:py-24">
            <div class="container mx-auto px-4">
                <div class="text-center max-w-3xl mx-auto">
                    <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight text-white">Loved by Developers, Trusted by Businesses</h2>
                    <p class="mt-4 text-lg text-slate-400">Don't just take our word for it. Here's what people are saying.</p>
                </div>
                <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">
                    <div class="bg-slate-800/50 p-8 rounded-2xl border border-slate-700">
                        <p class="text-slate-300 mb-6">"SecuraScan gave us an instant, actionable snapshot of our security. The AI summary was brilliant—I finally understood our risk without reading a 50-page doc."</p>
                        <div class="flex items-center">
                            <img class="w-12 h-12 rounded-full object-cover" src="https://images.unsplash.com/photo-1557862921-37829c790f19?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80" alt="User 1">
                            <div class="ml-4">
                                <p class="text-white font-bold">Alex Chen</p>
                                <p class="text-sm text-slate-400">CTO, StartUp Inc.</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-slate-800/50 p-8 rounded-2xl border border-slate-700">
                        <p class="text-slate-300 mb-6">"The best part is the prioritization. As a solo developer, I need to know what to fix first. This tool told me exactly where the biggest fire was."</p>
                        <div class="flex items-center">
                            <img class="w-12 h-12 rounded-full object-cover" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80" alt="User 2">
                            <div class="ml-4">
                                <p class="text-white font-bold">Maria Garcia</p>
                                <p class="text-sm text-slate-400">Freelance Web Developer</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-slate-800/50 p-8 rounded-2xl border border-slate-700">
                        <p class="text-slate-300 mb-6">"This is now a mandatory step in our CI/CD pipeline. The advanced scan is affordable and gives our clients incredible peace of mind. A total game-changer."</p>
                        <div class="flex items-center">
                            <img class="w-12 h-12 rounded-full object-cover" src="https://images.unsplash.com/photo-1556157382-97eda2d622e3?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80" alt="User 3">
                            <div class="ml-4">
                                <p class="text-white font-bold">David Kim</p>
                                <p class="text-sm text-slate-400">DevOps Lead, AgencyCo</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pricing Section -->
        <section id="pricing" class="py-16 sm:py-24 bg-slate-900/50">
            <div class="container mx-auto px-4">
                <div class="text-center max-w-3xl mx-auto">
                    <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight text-white">Fair Pricing for Continuous Security</h2>
                    <p class="mt-4 text-lg text-slate-400">Choose a plan that fits your needs. More scans, more security.</p>
                </div>
                <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                    <!-- Pricing Tier 1 -->
                    <div class="border border-slate-700 rounded-2xl p-8 flex flex-col card-glow bg-slate-800/50">
                        <h3 class="text-2xl font-bold text-white">Starter</h3>
                        <p class="mt-2 text-slate-400">For small projects & hobbyists.</p>
                        <p class="mt-6 text-4xl font-extrabold text-white">$5<span class="text-lg font-medium text-slate-400">/mo</span></p>
                        <ul class="mt-8 space-y-3 text-slate-300">
                            <li class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>25 Passive Scans / day</span>
                            </li>
                            <li class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>AI Report Summary</span>
                            </li>
                            <li class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>Scan History (7 Days)</span>
                            </li>
                        </ul>
                        <button data-plan="Starter" data-price="5" data-scans="25" class="choose-plan-btn mt-10 block w-full text-center bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors">Choose Starter</button>
                    </div>
                    <!-- Pricing Tier 2 (Featured) -->
                    <div class="border-2 border-indigo-500 rounded-2xl p-8 flex flex-col relative card-glow bg-slate-800">
                        <span class="absolute top-0 -translate-y-1/2 bg-indigo-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase">Most Popular</span>
                        <h3 class="text-2xl font-bold text-white">Pro</h3>
                        <p class="mt-2 text-slate-400">For freelancers & small teams.</p>
                        <p class="mt-6 text-4xl font-extrabold text-white">$8<span class="text-lg font-medium text-slate-400">/mo</span></p>
                        <ul class="mt-8 space-y-3 text-slate-300">
                            <li class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>50 Passive Scans / day</span>
                            </li>
                            <li class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>AI Report Summary & Chat</span>
                            </li>
                            <li class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>Full Scan History</span>
                            </li>
                        </ul>
                        <button data-plan="Pro" data-price="8" data-scans="50" class="choose-plan-btn mt-10 block w-full text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition-transform hover:scale-105">Choose Pro</button>
                    </div>
                    <!-- Pricing Tier 3 -->
                    <div class="border border-slate-700 rounded-2xl p-8 flex flex-col card-glow bg-slate-800/50">
                        <h3 class="text-2xl font-bold text-white">Business</h3>
                        <p class="mt-2 text-slate-400">For agencies & large sites.</p>
                        <p class="mt-6 text-4xl font-extrabold text-white">$16<span class="text-lg font-medium text-slate-400">/mo</span></p>
                        <ul class="mt-8 space-y-3 text-slate-300">
                           <li class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>Unlimited Passive Scans</span>
                            </li>
                            <li class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>AI Report Summary & Chat</span>
                            </li>
                            <li class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span>Full Scan History</span>
                            </li>
                        </ul>
                         <button data-plan="Business" data-price="16" data-scans="-1" class="choose-plan-btn mt-10 block w-full text-center bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors">Choose Business</button>
                    </div>
                </div>
                 <p class="text-center text-slate-400 mt-12"><strong>Advanced Scans</strong> are billed separately at <strong>$25 per URL</strong> and are available to all logged-in users.</p>
            </div>
        </section>
        
        <!-- About Us Section -->
        <section id="about" class="py-16 sm:py-24">
            <div class="container mx-auto px-4 max-w-4xl">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                    <div>
                         <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight text-white">About SecuraScan</h2>
                         <p class="mt-4 text-lg text-slate-400">Our mission is to make web security simple, accessible, and affordable for everyone—from hobbyist bloggers to growing businesses.</p>
                         <p class="mt-4 text-slate-300">We started SecuraScan because we saw too many great ideas get compromised by simple, preventable security flaws. We believe you shouldn't have to be a cybersecurity expert to build a safe website. Our tool is built on values of transparency, privacy, and simplicity, giving you the power to secure your work without the headache.</p>
                    </div>
                    <div class="bg-slate-800/50 p-8 rounded-2xl border border-slate-700 space-y-4">
                        <h3 class="text-xl font-bold text-white">Our Values</h3>
                         <div class="flex items-start space-x-3">
                            <svg class="w-5 h-5 text-indigo-400 flex-shrink-0 mt-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            <div>
                                <h4 class="font-semibold text-white">Transparency</h4>
                                <p class="text-sm text-slate-400">Clear, honest results. No jargon, just answers.</p>
                            </div>
                         </div>
                         <div class="flex items-start space-x-3">
                            <svg class="w-5 h-5 text-indigo-400 flex-shrink-0 mt-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            <div>
                                <h4 class="font-semibold text-white">Privacy First</h4>
                                <p class="text-sm text-slate-400">We only scan what you ask, and we never store your site's data.</p>
                            </div>
                         </div>
                         <div class="flex items-start space-x-3">
                            <svg class="w-5 h-5 text-indigo-400 flex-shrink-0 mt-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            <div>
                                <h4 class="font-semibold text-white">Simplicity</h4>
                                <p class="text-sm text-slate-400">Powerful security doesn't have to be complicated.</p>
                            </div>
                         </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Blog Section -->
        <section id="blog" class="py-16 sm:py-24 bg-slate-900/50">
            <div class="container mx-auto px-4">
                <div class="text-center max-w-3xl mx-auto">
                    <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight text-white">Blog & Insights</h2>
                    <p class="mt-4 text-lg text-slate-400">Stay ahead of threats with our latest articles on web security and best practices.</p>
                </div>
                <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Blog Post 1 -->
                    <div class="bg-slate-800/50 rounded-2xl border border-slate-700 overflow-hidden flex flex-col">
                        <img class="h-48 w-full object-cover" src="https://images.unsplash.com/photo-1554672408-758865e6de6a?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Conceptual WordPress Security" onerror="this.src='https://placehold.co/600x400/1e293b/94a3b8?text=WordPress+Security'">
                        <div class="p-6 flex flex-col flex-grow">
                            <h3 class="text-xl font-bold text-white mb-2">How to Secure WordPress in 2025</h3>
                            <p class="text-slate-400 text-sm flex-grow">WordPress is powerful, but it's also a target. Here are 5 key steps to lock down your site.</p>
                            <a href="#" class="mt-4 text-indigo-400 font-semibold hover:text-indigo-300">Read More &rarr;</a>
                        </div>
                    </div>
                    <!-- Blog Post 2 -->
                    <div class="bg-slate-800/50 rounded-2xl border border-slate-700 overflow-hidden flex flex-col">
                        <img class="h-48 w-full object-cover" src="https://images.unsplash.com/photo-1563206767-5b18f218e8de?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Abstract digital security concept">
                        <div class="p-6 flex flex-col flex-grow">
                            <h3 class="text-xl font-bold text-white mb-2">OWASP Top 10 Explained Simply</h3>
                            <p class="text-slate-400 text-sm flex-grow">We break down the 10 most critical web vulnerabilities in plain English, so you know what to look for.</p>
                            <a href="#" class="mt-4 text-indigo-400 font-semibold hover:text-indigo-300">Read More &rarr;</a>
                        </div>
                    </div>
                    <!-- Blog Post 3 -->
                    <div class="bg-slate-800/50 rounded-2xl border border-slate-700 overflow-hidden flex flex-col">
                        <img class="h-48 w-full object-cover" src="https://images.unsplash.com/photo-1599658880436-c0173e5172a0?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Glowing padlock representing SSL">
                        <div class="p-6 flex flex-col flex-grow">
                            <h3 class="text-xl font-bold text-white mb-2">What SSL Misconfigurations Can Cost You</h3>
                            <p class="text-slate-400 text-sm flex-grow">That little lock icon is more important than you think. Learn how simple errors can expose your users.</p>
                            <a href="#" class="mt-4 text-indigo-400 font-semibold hover:text-indigo-300">Read More &rarr;</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section id="faq" class="py-16 sm:py-24">
            <div class="container mx-auto px-4 max-w-3xl">
                <div class="text-center">
                    <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight text-white">Frequently Asked Questions</h2>
                    <p class="mt-4 text-lg text-slate-400">Have questions? We have answers.</p>
                </div>
                <div class="mt-12 space-y-6">
                    <!-- FAQ Item 1 -->
                    <details class="bg-slate-800/50 border border-slate-700 rounded-lg p-6 group">
                        <summary class="flex justify-between items-center cursor-pointer text-lg font-semibold text-white group-open:text-indigo-400">
                            What's the difference between a passive and active scan?
                            <span class="text-indigo-400 group-open:rotate-180 transition-transform">&darr;</span>
                        </summary>
                        <p class="text-slate-300 mt-4">A passive scan (our free scan) is non-intrusive. It only looks at publicly available information, like server headers and SSL certificates, to find misconfigurations. An active scan (our paid scan) safely probes your site for deeper vulnerabilities like SQL Injection and Cross-Site Scripting (XSS).</p>
                    </details>
                    <!-- FAQ Item 2 -->
                    <details class="bg-slate-800/50 border border-slate-700 rounded-lg p-6 group">
                        <summary class="flex justify-between items-center cursor-pointer text-lg font-semibold text-white group-open:text-indigo-400">
                            Is it safe to scan my website?
                            <span class="text-indigo-400 group-open:rotate-180 transition-transform">&darr;</span>
                        </summary>
                        <p class="text-slate-300 mt-4">Yes. Our free, passive scan is 100% safe and non-intrusive. Our paid, active scan uses industry-standard, non-destructive techniques. However, we strictly require that you only scan websites you own or have explicit written permission to test.</p>
                    </details>
                    <!-- FAQ Item 3 -->
                    <details class="bg-slate-800/50 border border-slate-700 rounded-lg p-6 group">
                        <summary class="flex justify-between items-center cursor-pointer text-lg font-semibold text-white group-open:text-indigo-400">
                            Do you store my website's data after a scan?
                            <span class="text-indigo-400 group-open:rotate-180 transition-transform">&darr;</span>
                        </summary>
                        <p class="text-slate-300 mt-4">For free, anonymous scans, no scan data is stored. If you create an account, we store your scan *history* (the URL, date, and findings) so you can track your progress over time. We never store raw page content or sensitive data from your site.</p>
                    </details>
                    <!-- FAQ Item 4 -->
                    <details class="bg-slate-800/50 border border-slate-700 rounded-lg p-6 group">
                        <summary class="flex justify-between items-center cursor-pointer text-lg font-semibold text-white group-open:text-indigo-400">
                            What if I get a bad rating? How do I fix it?
                            <span class="text-indigo-400 group-open:rotate-180 transition-transform">&darr;</span>
                        </summary>
                        <p class="text-slate-300 mt-4">Don't panic! A bad rating is the first step to a better site. Our reports are prioritized to show you the most critical issues first. Each finding includes a "How to Fix" guide. Plus, our AI Assistant can answer questions and even help you with code examples to fix the problem.</p>
                    </details>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-slate-900 border-t border-slate-800">
            <div class="container mx-auto px-8 py-12">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                    <div>
                        <h4 class="text-lg font-bold text-white mb-4">Secura<span class="text-indigo-400">Scan</span></h4>
                        <p class="text-sm text-slate-400">Simple, accessible web security.</p>
                    </div>
                    <div>
                        <h5 class="font-semibold text-slate-300 mb-4 uppercase text-sm tracking-wider">Product</h5>
                        <ul class="space-y-3">
                            <li><a href="#features" class="text-slate-400 hover:text-indigo-400 transition-colors">Features</a></li>
                            <li><a href="#pricing" class="text-slate-400 hover:text-indigo-400 transition-colors">Pricing</a></li>
                            <li><a href="#" class="text-slate-400 hover:text-indigo-400 transition-colors">Advanced Scan</a></li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="font-semibold text-slate-300 mb-4 uppercase text-sm tracking-wider">Company</h5>
                        <ul class="space-y-3">
                            <li><a href="#about" class="text-slate-400 hover:text-indigo-400 transition-colors">About Us</a></li>
                            <li><a href="#blog" class="text-slate-400 hover:text-indigo-400 transition-colors">Blog</a></li>
                            <li><a href="#contact" class="text-slate-400 hover:text-indigo-400 transition-colors">Contact</a></li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="font-semibold text-slate-300 mb-4 uppercase text-sm tracking-wider">Legal & Trust</h5>
                        <ul class="space-y-3">
                            <li><a href="#privacy" class="text-slate-400 hover:text-indigo-400 transition-colors">Privacy Policy</a></li>
                            <li><a href="#tos" class="text-slate-400 hover:text-indigo-400 transition-colors">Terms of Service</a></li>
                            <li><a href="#disclaimer" class="text-slate-400 hover:text-indigo-400 transition-colors">Disclaimer</a></li>
                            <li><a href="#gdpr" class="text-slate-400 hover:text-indigo-400 transition-colors">GDPR</a></li>
                        </ul>
                    </div>
                </div>
                <div class="mt-10 pt-8 border-t border-slate-800 flex justify-between items-center">
                    <p class="text-sm text-slate-500">&copy; 2025 SecuraScan. All rights reserved.</p>
                    <div class="flex space-x-4">
                        <!-- Social Icons -->
                         <a href="#" class="text-slate-500 hover:text-indigo-400 transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.67.88-.53 1.56-1.37 1.88-2.38-.83.49-1.75.85-2.72 1.04C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.27 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.48.75 2.79 1.9 3.55-.7-.02-1.36-.21-1.94-.53v.05c0 2.07 1.47 3.8 3.42 4.19-.36.1-.74.15-1.13.15-.27 0-.54-.03-.8-.08.54 1.7 2.1 2.93 3.96 2.97-1.46 1.14-3.3 1.82-5.3 1.82-.34 0-.68-.02-1.02-.06 1.89 1.21 4.12 1.92 6.56 1.92 7.88 0 12.2-6.54 12.2-12.2 0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"></path></svg>
                        </a>
                        <a href="#" class="text-slate-500 hover:text-indigo-400 transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 18H5V9h3v9zm-1.5-10.26c-.97 0-1.75-.79-1.75-1.76s.78-1.76 1.75-1.76 1.75.79 1.75 1.76-.78 1.76-1.75 1.76zM19 18h-3v-5.4c0-1.28-.02-2.93-1.78-2.93-1.78 0-2.05 1.39-2.05 2.84V18h-3V9h2.88v1.32h.04c.4-.76 1.37-1.55 2.84-1.55 3.04 0 3.6 2.01 3.6 4.61V18z"></path></svg>
                        </a>
                        <a href="#" class="text-slate-500 hover:text-indigo-400 transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12c0 4.42 2.87 8.17 6.84 9.5.5.09.68-.22.68-.48 0-.24-.01-1.02-.01-1.8-2.6.57-3.15-1.11-3.23-1.36-.08-.2-.48-.96-.82-1.16-.28-.16-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.28.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .26.18.57.69.48C19.13 20.17 22 16.42 22 12c0-5.52-4.48-10-10-10z"></M12>
                        </a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 modal-overlay opacity-0 pointer-events-none">
        <div class="bg-slate-800 rounded-2xl w-full max-w-sm p-8 shadow-2xl modal-content transform scale-95">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modal-title" class="text-2xl font-bold text-white">Log In</h2>
                <button id="closeModalBtn" class="text-slate-400 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <p id="auth-error" class="text-red-400 text-sm mb-4 h-5"></p>
            <form id="auth-form" class="space-y-4">
                 <div id="displayNameField" class="signup-field">
                    <input type="text" id="displayName-input" placeholder="Display Name" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <input type="email" id="email-input" placeholder="Email address" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <input type="password" id="password-input" placeholder="Password" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <div id="confirmPasswordField" class="signup-field">
                    <input type="password" id="confirmPassword-input" placeholder="Confirm Password" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                 <div id="profilePictureField" class="signup-field">
                    <label for="profilePicture-input" class="text-sm text-slate-400">Profile Picture (Optional)</label>
                    <input type="file" id="profilePicture-input" accept="image/*" class="w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-500 file:text-white hover:file:bg-indigo-600">
                </div>
                <button type="submit" id="modal-submit-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 mt-2 rounded-lg transition-colors">Log In</button>
            </form>
             <p class="text-center text-sm text-slate-400 mt-6">
                <span id="modal-switch-text">Don't have an account?</span>
                <button id="modal-switch-btn" class="font-semibold text-indigo-400 hover:text-indigo-300">Sign Up</button>
            </p>
        </div>
    </div>
    
    <!-- Profile Modal -->
    <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 modal-overlay opacity-0 pointer-events-none">
        <div class="bg-slate-800 rounded-2xl w-full max-w-2xl p-8 shadow-2xl modal-content transform scale-95 flex flex-col" style="max-height: 90vh;">
            <div class="flex-shrink-0 flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">My Profile</h2>
                <button id="closeProfileModalBtn" class="text-slate-400 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <div class="flex-shrink-0 flex items-center space-x-6 pb-6 border-b border-slate-700">
                <img id="profilePicturePreview" src="https://placehold.co/80x80/1e293b/94a3b8?text=U" alt="Profile Picture">
                <div>
                    <h3 id="profileDisplayName" class="text-xl font-bold text-white"></h3>
                    <p id="profileEmail" class="text-slate-400"></p>
                </div>
            </div>
            <div class="flex-grow overflow-y-auto mt-6">
                 <h4 class="text-lg font-semibold text-white mb-4">Scan History</h4>
                 <div id="scanHistoryContainer" class="space-y-3">
                     <!-- Scan history will be populated here -->
                     <p class="text-slate-500">No scans performed yet.</p>
                 </div>
            </div>
        </div>
    </div>
    
    <!-- Payment Modal (Simulation) -->
    <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 modal-overlay opacity-0 pointer-events-none">
        <div class="bg-slate-800 rounded-2xl w-full max-w-md p-8 shadow-2xl modal-content transform scale-95">
             <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-white">Upgrade Plan</h2>
                <button id="closePaymentModalBtn" class="text-slate-400 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <div id="paymentSummary" class="mb-6 p-4 bg-slate-700/50 rounded-lg">
                <p>Plan: <span id="paymentPlanName" class="font-bold text-indigo-400"></span></p>
                <p>Price: <span id="paymentPlanPrice" class="font-bold text-white"></span>/month</p>
            </div>
             <p id="payment-error" class="text-red-400 text-sm mb-4 h-5"></p>
            <form id="payment-form" class="space-y-4">
                 <input type="text" placeholder="Card Number (e.g., 4242 4242 4242 4242)" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                 <div class="flex gap-4">
                    <input type="text" placeholder="MM / YY" class="w-1/2 bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <input type="text" placeholder="CVC" class="w-1/2 bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                 </div>
                <button type="submit" id="payment-submit-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 mt-2 rounded-lg transition-colors flex items-center justify-center space-x-2">
                    Pay Now
                </button>
            </form>
             <p class="text-center text-xs text-slate-500 mt-4">This is a simulated payment. No real transaction will occur.</p>
        </div>
    </div>

    <script type="module">
        // Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut,
            signInAnonymously,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc, 
            setDoc,
            addDoc,
            onSnapshot,
            collection,
            serverTimestamp,
            updateDoc,
            query,
            orderBy
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import {
            getStorage,
            ref,
            uploadBytes,
            getDownloadURL
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // --- Mock Firebase Config and App ID (for demo) ---
        // REPLACE WITH YOUR ACTUAL FIREBASE CONFIG
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { 
            apiKey: "AIzaSyBxDM_vpo7cEKhhbc5-XNDU_dI3WIPmxjQ", 
            authDomain: "securascan-project.firebaseapp.com", 
            projectId: "securascan-project", 
            storageBucket: "securascan-project.firebasestorage.app", 
            messagingSenderId: "1043568609525", 
            appId: "1:1043568609525:web:3a0133ee19ad484241ddbc",
            measurementId: "G-6VTXFCC2J2",
        };
        
        // --- App ID Sanitization ---
        // Fix for "Invalid document reference" error in some environments
        let rawAppId = typeof __app_id !== 'undefined' ? __app_id : 'securascan-prod';
        if (rawAppId.includes('/')) {
            rawAppId = rawAppId.split('/')[0];
        }
        const appId = rawAppId;


        // --- Gemini API Key ---
        // IMPORTANT: LEAVE THIS EMPTY. The key will be provided by the environment.
        const apiKey = ""; 
        const genAIApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- Razorpay Links ---
        // REPLACE WITH YOUR ACTUAL RAZORPAY PAYMENT LINKS
        const razorpayPaymentLinks = {
            "Starter": "https://rzp.io/l/YOUR_STARTER_LINK",
            "Pro": "https://rzp.io/l/YOUR_PRO_LINK",
            "Business": "https://rzp.io/l/YOUR_BUSINESS_LINK"
        };
        
        // --- Firebase Initialization ---
        let app, auth, db, storage;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            storage = getStorage(app);
        } catch (error) {
            console.error("Firebase initialization failed:", error);
            document.body.innerHTML = '<div style="color: white; padding: 20px; text-align: center;">Error: Could not initialize Firebase. Please check your configuration.</div>';
        }


        // --- DOM Elements ---
        const urlInput = document.getElementById('urlInput');
        const scanButton = document.getElementById('scanButton');
        const errorMessage = document.getElementById('errorMessage');
        
        // --- Views ---
        const initialView = document.getElementById('initialView');
        const scanningView = document.getElementById('scanningView');
        const resultsView = document.getElementById('resultsView');
        
        // --- Results Elements ---
        const scannedUrlResult = document.getElementById('scannedUrlResult');
        const ratingCircle = document.getElementById('ratingCircle');
        const ratingGrade = document.getElementById('ratingGrade');
        const sslDetails = document.getElementById('sslDetails');
        const findingsList = document.getElementById('findingsList');
        const scanAgainBtn = document.getElementById('scanAgainBtn');
        const downloadPdfBtn = document.getElementById('downloadPdfBtn');
        const shareButton = document.getElementById('shareButton');
        const shareSuccessMessage = document.getElementById('shareSuccessMessage');

        // --- AI Elements ---
        const aiSummaryBtn = document.getElementById('aiSummaryBtn');
        const aiSummaryContent = document.getElementById('aiSummaryContent');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const chatSendBtn = document.getElementById('chatSendBtn');
        const chatWindow = document.getElementById('chatWindow');

        // --- Auth UI Elements ---
        const userInfo = document.getElementById('user-info');
        const guestInfo = document.getElementById('guest-info');
        const userDisplayNameSpan = document.getElementById('user-display-name');
        const navProfilePic = document.getElementById('navProfilePic');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginBtnNav = document.getElementById('loginBtnNav');
        const signUpBtnNav = document.getElementById('signUpBtnNav');

        // --- Auth Modal ---
        const authModal = document.getElementById('authModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const modalTitle = document.getElementById('modal-title');
        const authForm = document.getElementById('auth-form');
        const displayNameField = document.getElementById('displayNameField');
        const confirmPasswordField = document.getElementById('confirmPasswordField');
        const profilePictureField = document.getElementById('profilePictureField');
        const displayNameInput = document.getElementById('displayName-input');
        const emailInput = document.getElementById('email-input');
        const passwordInput = document.getElementById('password-input');
        const confirmPasswordInput = document.getElementById('confirmPassword-input');
        const profilePictureInput = document.getElementById('profilePicture-input');
        const modalSubmitBtn = document.getElementById('modal-submit-btn');
        const modalSwitchBtn = document.getElementById('modal-switch-btn');
        const authError = document.getElementById('auth-error');

        // --- Profile Modal ---
        const profileModal = document.getElementById('profileModal');
        const profileBtn = document.getElementById('profileBtn');
        const closeProfileModalBtn = document.getElementById('closeProfileModalBtn');
        const profilePicturePreview = document.getElementById('profilePicturePreview');
        const profileDisplayName = document.getElementById('profileDisplayName');
        const profileEmail = document.getElementById('profileEmail');
        const scanHistoryContainer = document.getElementById('scanHistoryContainer');
        
        // --- Payment Modal (Simulation) ---
        const paymentModal = document.getElementById('paymentModal');
        const closePaymentModalBtn = document.getElementById('closePaymentModalBtn');
        const paymentForm = document.getElementById('payment-form');
        const paymentPlanName = document.getElementById('paymentPlanName');
        const paymentPlanPrice = document.getElementById('paymentPlanPrice');
        const paymentSubmitBtn = document.getElementById('payment-submit-btn');
        const paymentError = document.getElementById('payment-error');


        // --- App State ---
        let currentUser = null;
        let userData = null;
        let isModalForLogin = true;
        let unsubscribeScanListener = null;
        let unsubscribeHistoryListener = null;
        let isAuthReady = false;
        let currentScanData = null; // Store results for AI chat and PDF
        let aiChatHistory = [];

        // --- Authentication ---
        if(auth) {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    currentUser = user;
                    await fetchUserData(user.uid);
                    if (!user.isAnonymous) {
                       listenToScanHistory(user.uid);
                    }
                } else {
                    currentUser = null;
                    userData = null;
                    if (unsubscribeHistoryListener) unsubscribeHistoryListener();
                    // Sign in anonymously if no user
                    try {
                        const anonUser = await signInAnonymously(auth);
                        currentUser = anonUser.user;
                        await fetchUserData(currentUser.uid);
                    } catch (error) {
                        console.error("Anonymous sign-in failed:", error);
                    }
                }
                isAuthReady = true;
                updateUIAfterAuthChange(!!user && !user.isAnonymous);
            });
        }
        
        async function fetchUserData(userId) {
            if (!userId || !db) {
                isAuthReady = true; // Still ready, just no user data
                updateScanButtonState();
                return;
            }
            
            const userDocRef = doc(db, `artifacts/${appId}/users/${userId}`);
            
            try {
                const userDocSnap = await getDoc(userDocRef);
                if (userDocSnap.exists()) {
                    userData = userDocSnap.data();
                } else if (currentUser && !currentUser.isAnonymous) {
                    // Create new user doc
                    const newUser = {
                        email: currentUser.email,
                        displayName: currentUser.displayName || 'New User',
                        photoURL: currentUser.photoURL || `https://placehold.co/80x80/1e293b/94a3b8?text=${currentUser.email[0].toUpperCase()}`,
                        scansRemaining: 5,
                        subscription: 'free',
                        createdAt: serverTimestamp()
                    };
                    await setDoc(userDocRef, newUser);
                    userData = newUser;
                } else if (currentUser && currentUser.isAnonymous) {
                     // Create new anonymous user doc
                     const anonUser = { 
                         scansRemaining: 1, 
                         subscription: 'anonymous',
                         createdAt: serverTimestamp()
                    };
                     await setDoc(userDocRef, anonUser);
                     userData = anonUser;
                }
            } catch (error) {
                console.error("Error fetching user data:", error);
            }
        }
        
        function updateUIAfterAuthChange(isLoggedIn) {
            if (isLoggedIn && currentUser && userData) {
                userInfo.classList.remove('hidden');
                userInfo.classList.add('flex');
                guestInfo.classList.add('hidden');
                userDisplayNameSpan.textContent = userData.displayName;
                navProfilePic.src = userData.photoURL;
            } else {
                userInfo.classList.add('hidden');
                guestInfo.classList.remove('hidden');
                guestInfo.classList.add('flex');
            }
            updateScanButtonState();
        }

        function updateScanButtonState() {
            if (!isAuthReady || !userData) {
                scanButton.disabled = true;
                scanButton.classList.add('opacity-50', 'cursor-not-allowed');
                document.getElementById('scan-button-text').textContent = 'Initializing...';
                return;
            }

            const scansLeft = userData.scansRemaining;
            const scanText = (userData.subscription !== 'free' && userData.subscription !== 'anonymous') ? 'Scans today' : 'Free scans left';
            const scanCount = (scansLeft === -1) ? 'Unlimited' : scansLeft;

            document.getElementById('scan-button-text').textContent = `Scan (${scanCount} ${scanText})`;

            if (scansLeft === 0) {
                scanButton.disabled = true;
                scanButton.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                scanButton.disabled = false;
                scanButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }


        // --- Modal Logic ---
        function toggleGenericModal(modalElement, show) {
            if (show) {
                modalElement.classList.remove('opacity-0', 'pointer-events-none');
                modalElement.querySelector('.modal-content').classList.remove('scale-95');
            } else {
                modalElement.classList.add('opacity-0', 'pointer-events-none');
                modalElement.querySelector('.modal-content').classList.add('scale-95');
            }
        }

        // --- Auth Modal ---
        loginBtnNav.addEventListener('click', () => openAuthModal(true));
        signUpBtnNav.addEventListener('click', () => openAuthModal(false));
        closeModalBtn.addEventListener('click', () => toggleGenericModal(authModal, false));
        modalSwitchBtn.addEventListener('click', () => openAuthModal(!isModalForLogin));
        
        function openAuthModal(isLogin) {
            isModalForLogin = isLogin;
            authError.textContent = '';
            authForm.reset();
            
            modalTitle.textContent = isLogin ? 'Log In' : 'Sign Up Free';
            modalSubmitBtn.textContent = isLogin ? 'Log In' : 'Create Account';
            document.getElementById('modal-switch-text').textContent = isLogin ? "Don't have an account?" : "Already have an account?";
            modalSwitchBtn.textContent = isLogin ? 'Sign Up' : 'Log In';

            displayNameField.classList.toggle('visible', !isLogin);
            confirmPasswordField.classList.toggle('visible', !isLogin);
            profilePictureField.classList.toggle('visible', !isLogin);

            toggleGenericModal(authModal, true);
        }

        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;
            authError.textContent = '';

            if (isModalForLogin) { // Login
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    toggleGenericModal(authModal, false);
                } catch (error) {
                    authError.textContent = error.message.replace('Firebase: ', '');
                }
            } else { // Sign Up
                const displayName = displayNameInput.value;
                const confirmPassword = confirmPasswordInput.value;
                const profilePictureFile = profilePictureInput.files[0];

                if (password !== confirmPassword) {
                    authError.textContent = "Passwords do not match.";
                    return;
                }
                if (!displayName) {
                    authError.textContent = "Display name is required.";
                    return;
                }

                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    let photoURL = `https://placehold.co/80x80/1e293b/94a3b8?text=${displayName[0].toUpperCase()}`;

                    if (profilePictureFile) {
                        const storageRef = ref(storage, `profilePictures/${user.uid}`);
                        await uploadBytes(storageRef, profilePictureFile);
                        photoURL = await getDownloadURL(storageRef);
                    }
                    
                    await updateProfile(user, { displayName, photoURL });
                    
                    // Explicitly set the new user data
                    const newUser = {
                        email: user.email,
                        displayName: displayName,
                        photoURL: photoURL,
                        scansRemaining: 5,
                        subscription: 'free',
                        createdAt: serverTimestamp()
                    };
                    await setDoc(doc(db, `artifacts/${appId}/users/${user.uid}`), newUser);
                    
                    userData = newUser; // Update local state immediately
                    updateUIAfterAuthChange(true); // Update UI
                    
                    toggleGenericModal(authModal, false);
                } catch (error) {
                    authError.textContent = error.message.replace('Firebase: ', '');
                }
            }
        });

        logoutBtn.addEventListener('click', () => signOut(auth));
        
        // --- Profile Modal ---
        profileBtn.addEventListener('click', () => {
            if (currentUser && userData && !currentUser.isAnonymous) {
                profilePicturePreview.src = userData.photoURL;
                profileDisplayName.textContent = userData.displayName;
                profileEmail.textContent = currentUser.email;
                toggleGenericModal(profileModal, true);
            } else {
                openAuthModal(false); // Prompt to sign up
            }
        });
        closeProfileModalBtn.addEventListener('click', () => toggleGenericModal(profileModal, false));
        
        function listenToScanHistory(userId) {
            if (unsubscribeHistoryListener) unsubscribeHistoryListener();
            if(!db) return;
            const scansQuery = query(collection(db, `artifacts/${appId}/users/${userId}/scans`), orderBy('createdAt', 'desc'));
            
            unsubscribeHistoryListener = onSnapshot(scansQuery, (snapshot) => {
                if (snapshot.empty) {
                    scanHistoryContainer.innerHTML = '<p class="text-slate-500">No scans performed yet.</p>';
                    return;
                }
                scanHistoryContainer.innerHTML = '';
                snapshot.forEach(doc => {
                    const scan = doc.data();
                    const date = scan.createdAt?.toDate().toLocaleString() || 'N/A';
                    const historyItem = document.createElement('div');
                    historyItem.className = 'p-3 bg-slate-700/50 rounded-lg flex justify-between items-center';
                    historyItem.innerHTML = `
                        <div>
                            <p class="font-semibold text-white truncate">${scan.url}</p>
                            <p class="text-xs text-slate-400">${date}</p>
                        </div>
                        <span class="font-bold text-lg px-3 py-1 rounded-md rating-${scan.results?.rating}">${scan.results?.rating || '?'}</span>
                    `;
                    scanHistoryContainer.appendChild(historyItem);
                });
            }, (error) => {
                console.error("Error listening to scan history:", error);
            });
        }
        
        // --- Payment Logic (Razorpay Redirect) ---
        document.querySelectorAll('.choose-plan-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                if (!currentUser || currentUser.isAnonymous) {
                     openAuthModal(false); // Prompt to sign up
                     return;
                }
                const plan = e.target.dataset.plan;
                const baseLink = razorpayPaymentLinks[plan];
                
                // For a real integration, you MUST generate this link on your backend
                // to securely embed the user_id in the link's `notes` field.
                // The backend would then return this unique link to the frontend.
                // For this demo, we just open the base link.
                
                console.log(`Redirecting to payment for plan: ${plan}`);
                // Open in new tab
                window.open(baseLink, '_blank');
            });
        });
        
        // --- Close Payment Modal (Simulation) ---
        closePaymentModalBtn.addEventListener('click', () => toggleGenericModal(paymentModal, false));


        // --- Scanning Logic ---
        scanButton.addEventListener('click', handleFreeScan);
        scanAgainBtn.addEventListener('click', resetToInitialView);
        downloadPdfBtn.addEventListener('click', generatePdfReport);
        shareButton.addEventListener('click', shareScanResults);

        function validateUrl(url) {
            if (!url) {
                errorMessage.textContent = 'Please enter a URL.';
                return false;
            }
            try {
                const parsedUrl = new URL(url);
                if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {
                    errorMessage.textContent = 'Please enter a valid URL (http:// or https://).';
                    return false;
                }
                errorMessage.textContent = '';
                return true;
            } catch (_) {
                errorMessage.textContent = 'Please enter a valid URL.';
                return false;
            }
        }

        async function handleFreeScan() {
            const url = urlInput.value.trim();
            if (!validateUrl(url) || !currentUser || !userData) {
                 if(!currentUser || !userData) errorMessage.textContent = 'Authenticating... please wait.';
                return;
            }

            if (userData.scansRemaining === 0) {
                 errorMessage.textContent = 'You have no scans remaining. Please upgrade.';
                 return;
            }

            // UI transition
            initialView.classList.add('hidden');
            resultsView.classList.add('hidden');
            scanningView.classList.remove('hidden');
            document.getElementById('scanningUrl').textContent = `Scanning: ${url}`;
            
            // Deduct scan count
            if (userData.scansRemaining > 0) {
                try {
                    const userDocRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}`);
                    await updateDoc(userDocRef, {
                        scansRemaining: userData.scansRemaining - 1
                    });
                    await fetchUserData(currentUser.uid); // Refresh local data
                } catch (error) {
                    console.error("Error deducting scan:", error);
                    errorMessage.textContent = 'Error starting scan. Please try again.';
                    resetToInitialView();
                    return;
                }
            }
            
            // --- This is where you would call your *real* backend scanning API ---
            // For this demo, we simulate it.
            const scanId = `scan_${Date.now()}`;
            simulateBackendScanComplete(currentUser.uid, scanId, url);
        }

        // Simulates the backend scanner finishing its job
        async function simulateBackendScanComplete(userId, scanId, url) {
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            // Generate simulated data
            const { results, sslData } = generateSimulatedScanData();
            const scanData = {
                id: scanId,
                url: url,
                userId: userId,
                status: 'completed',
                createdAt: serverTimestamp(),
                results: results,
                sslData: sslData
            };
            
            currentScanData = scanData; // Store for PDF/Chat
            
             // Save to user's history if they are not anonymous
            if (!currentUser.isAnonymous) {
                try {
                    await setDoc(doc(db, `artifacts/${appId}/users/${userId}/scans/${scanId}`), scanData);
                } catch (error) {
                    console.error("Error saving scan to history: ", error);
                }
            }

            // Display results
            displayResults(scanData);
        }
        
        function generateSimulatedScanData() {
            const grades = ['A', 'B', 'C', 'D', 'E'];
            const chosenGrade = grades[Math.floor(Math.random() * grades.length)];
            
            let findings = [];
            let sslData = {
                issuedTo: 'example.com',
                issuedBy: "Let's Encrypt",
                validFrom: '2025-01-01',
                validTo: '2025-04-01',
                protocol: 'TLSv1.3',
                strength: 'High (256-bit)',
                hsts: false
            };
            
            // Base findings
            findings.push({
                title: 'HTTPS Enforced',
                risk: 'Low',
                cwe: 'CWE-311',
                description: 'Checks if the site automatically redirects from HTTP to HTTPS.',
                impact: 'Without HTTPS, data between the user and the server is unencrypted and can be intercepted by attackers (Man-in-the-Middle).',
                recommendation: 'Configure your web server (Nginx, Apache, etc.) to issue a 301 Permanent Redirect for all HTTP requests to their HTTPS equivalent.',
                references: 'https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure'
            });
             findings.push({
                title: 'Robots.txt Configuration',
                risk: 'Low',
                cwe: 'CWE-219',
                description: 'Checks for a robots.txt file. Misconfigurations can sometimes expose sensitive directories.',
                impact: 'A poorly configured robots.txt might unintentionally reveal the paths to admin portals or other sensitive areas by listing them under `Disallow`.',
                recommendation: 'Ensure your robots.txt file does not disallow paths that do not exist or reveal sensitive directory structures. Use it only to block crawlers from non-public pages.',
                references: 'https://developers.google.com/search/docs/crawling-indexing/robots/intro'
            });

            switch (chosenGrade) {
                case 'A':
                    sslData.hsts = true;
                    findings.push({
                        title: 'Content Security Policy (CSP) Found',
                        risk: 'Low',
                        cwe: 'CWE-693',
                        description: 'A CSP header was detected, which helps prevent Cross-Site Scripting (XSS) and data injection attacks.',
                        impact: 'Without a CSP, an XSS vulnerability could allow an attacker to steal user data, deface the site, or redirect users to malicious websites.',
                        recommendation: 'This is great! Ensure your CSP is regularly reviewed and is strict enough to meet your application\'s needs.',
                        references: 'https://owasp.org/www-project-content-security-policy/'
                    });
                    break;
                case 'B':
                    sslData.hsts = true;
                    findings.push({
                        title: 'Missing X-Content-Type-Options Header',
                        risk: 'Medium',
                        cwe: 'CWE-693',
                        description: 'The `X-Content-Type-Options: nosniff` header is not set. This can lead to "MIME-sniffing" attacks.',
                        impact: 'Browsers may misinterpret the content type of a file (e.g., execute a plain text file as JavaScript). This can lead to XSS attacks.',
                        recommendation: 'Add the header `X-Content-Type-Options: nosniff` to all server responses.',
                        references: 'https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options'
                    });
                    break;
                case 'C':
                    findings.push({
                        title: 'Missing Content Security Policy (CSP)',
                        risk: 'Medium',
                        cwe: 'CWE-693',
                        description: 'The site is missing a Content Security Policy. This is a crucial defense against Cross-Site Scripting (XSS).',
                        impact: 'An XSS vulnerability could allow an attacker to steal user data, deface the site, or redirect users to malicious websites.',
                        recommendation: 'Implement a strict CSP that defines which dynamic resources (scripts, fonts, styles) are allowed to load. Start with a basic policy and tighten it.',
                        references: 'https://owasp.org/www-project-content-security-policy/'
                    });
                    findings.push({
                        title: 'Outdated JavaScript Library Detected',
                        risk: 'High',
                        cwe: 'CWE-1104',
                        description: 'The scanner detected `jQuery v2.1.0`, which is outdated and may contain known vulnerabilities.',
                        impact: 'Using outdated libraries with known security flaws can provide a direct entry point for attackers to exploit your website.',
                        recommendation: 'Update all third-party libraries to their latest stable versions. Regularly audit your dependencies for known vulnerabilities.',
                        references: 'https://owasp.org/www-project-top-ten/2021/A06_2021-Vulnerable_and_Outdated_Components'
                    });
                    break;
                case 'D':
                    findings.push({
                        title: 'Missing X-Frame-Options Header',
                        risk: 'Medium',
                        cwe: 'CWE-1021',
                        description: 'The `X-Frame-Options` header is not set, making the site vulnerable to "Clickjacking" attacks.',
                        impact: 'An attacker can embed your website in an invisible iframe on their own malicious site, tricking your users into clicking buttons or links on your site without their knowledge.',
                        recommendation: 'Add the header `X-Frame-Options: SAMEORIGIN` to prevent your site from being embedded in iframes on other domains.',
                        references: 'https://owasp.org/www-community/attacks/Clickjacking'
                    });
                    findings.push({
                        title: 'Missing security.txt file',
                        risk: 'Low',
                        cwe: 'CWE-1059',
                        description: 'The website does not have a `security.txt` file in the `.well-known` directory.',
                        impact: 'Security researchers may not have a clear, standardized way to report vulnerabilities they find, leading to issues being undisclosed or exploited.',
                        recommendation: 'Create a `security.txt` file and place it at `/.well-known/security.txt`. Include contact information for security reports.',
                        references: 'https://securitytxt.org/'
                    });
                    break;
                case 'E':
                    findings.push({
                        title: 'Critical forms lack CSRF protection',
                        risk: 'Critical',
                        cwe: 'CWE-352',
                        description: 'Forms (e.g., login, contact) appear to lack Anti-Cross-Site Request Forgery (CSRF) tokens.',
                        impact: 'An attacker can trick a logged-in user into performing actions they did not intend, such as changing their password or deleting their account.',
                        recommendation: 'Implement unique anti-CSRF tokens for all state-changing requests (POST, PUT, DELETE) and validate them on the server-side.',
                        references: 'https://owasp.org/www-community/attacks/Cross-Site_Request_Forgery_(CSRF)'
                    });
                    findings.push({
                        title: 'Application error messages reveal sensitive infrastructure details',
                        risk: 'High',
                        cwe: 'CWE-209',
                        description: 'Generic error pages show detailed stack traces, file paths, or server versions.',
                        impact: 'This information helps an attacker map out your server\'s file system, dependencies, and internal workings, making it easier to launch other attacks.',
                        recommendation: 'Configure your application to show only generic, non-detailed error messages to users. Log the full details on your server for debugging.',
                        references: 'https://owasp.org/www-project-top-ten/2021/A05_2021-Security_Misconfiguration'
                    });
                    // Added this finding as requested
                     findings.push({
                        title: 'Publicly exposed .git directory',
                        risk: 'Critical',
                        cwe: 'CWE-538',
                        description: 'A publicly accessible `.git` directory was found. This exposes your entire source code and history.',
                        impact: 'Attackers can download your complete source code, find database credentials, API keys, and discover other vulnerabilities.',
                        recommendation: 'Immediately block public access to the `.git` directory using your web server configuration (e.g., Nginx, Apache).',
                        references: 'https://owasp.org/www-project-top-ten/2021/A05_2021-Security_Misconfiguration'
                    });
                    break;
            }
            
            const results = {
                rating: chosenGrade,
                findings: findings.sort((a, b) => {
                    const riskOrder = { 'Critical': 4, 'High': 3, 'Medium': 2, 'Low': 1 };
                    return (riskOrder[b.risk] || 0) - (riskOrder[a.risk] || 0);
                })
            };

            return { results, sslData };
        }

        function displayResults(scanData) {
            const { results, sslData, url } = scanData;
            
            // Reset UI
            scannedUrlResult.textContent = `Report for: ${url}`;
            ratingGrade.textContent = results.rating;
            ratingCircle.className = `w-32 h-32 rounded-full flex items-center justify-center text-5xl font-extrabold mb-4 transition-all duration-500 rating-${results.rating}`;
            findingsList.innerHTML = '';
            sslDetails.innerHTML = '';
            aiSummaryContent.textContent = 'Click "Analyze with AI" to generate a simple, non-technical summary of your security findings.';
            aiSummaryContent.classList.add('italic');
            chatWindow.innerHTML = `<div class="chat-bubble ai">Hello! I'm here to help. Ask me anything about your results, like "What is CSRF?" or "How do I fix a missing CSP header?"</div>`;
            aiChatHistory = [];
            shareSuccessMessage.textContent = '';
            
            // Populate SSL Details
            sslDetails.innerHTML = `
                <li><strong>Issued To:</strong> ${sslData.issuedTo}</li>
                <li><strong>Issued By:</strong> ${sslData.issuedBy}</li>
                <li><strong>Valid From:</strong> ${sslData.validFrom}</li>
                <li><strong>Valid To:</strong> ${sslData.validTo}</li>
                <li><strong>Protocol:</strong> ${sslData.protocol}</li>
                <li><strong>HSTS Enabled:</strong> ${sslData.hsts ? '<span class="text-green-400">Yes</span>' : '<span class="text-red-400">No</span>'}</li>
            `;

            // Populate Findings
            if (results.findings.length === 0) {
                findingsList.innerHTML = '<p class="text-slate-300">No passive vulnerabilities found. Your site looks clean from here!</p>';
            } else {
                results.findings.forEach(finding => {
                    const findingElement = document.createElement('div');
                    findingElement.className = 'bg-slate-800/50 border border-slate-700 rounded-lg overflow-hidden';
                    findingElement.innerHTML = `
                        <div class="p-4 flex justify-between items-center">
                            <h4 class="text-lg font-bold text-white">${finding.title}</h4>
                            <span class="px-3 py-1 rounded-full text-sm font-semibold rating-${finding.risk.charAt(0)}">${finding.risk}</span>
                        </div>
                        <div class="p-4 border-t border-slate-700">
                            <p class="text-slate-300 mb-3"><strong class="text-white">Description:</strong> ${finding.description}</p>
                            <p class="text-slate-300 mb-3"><strong class="text-white">Impact:</strong> ${finding.impact}</p>
                            <p class="text-slate-300 mb-4"><strong class="text-white">Recommendation:</strong> ${finding.recommendation}</p>
                            <a href="${finding.references}" target="_blank" rel="noopener noreferrer" class="text-indigo-400 hover:text-indigo-300 text-sm font-semibold">Learn More &rarr;</a>
                        </div>
                    `;
                    findingsList.appendChild(findingElement);
                });
            }

            // Show results
            scanningView.classList.add('hidden');
            resultsView.classList.remove('hidden');
        }

        // --- AI Logic ---
        aiSummaryBtn.addEventListener('click', generateAiSummary);
        chatForm.addEventListener('submit', handleAiChat);

        async function callGeminiAPI(prompt, systemInstruction) {
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: {
                    parts: [{ text: systemInstruction }]
                },
            };

            try {
                // Implement exponential backoff for retries
                let response;
                let retries = 0;
                const maxRetries = 3;
                let delay = 1000;

                while (retries < maxRetries) {
                    response = await fetch(genAIApiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        break; // Success
                    }
                    
                    if (response.status === 429 || response.status >= 500) {
                        // Throttling or server error, wait and retry
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Exponential backoff
                        retries++;
                    } else {
                        // Other client-side error, don't retry
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }
                }
                
                if (!response.ok) {
                    throw new Error(`API failed after ${maxRetries} retries.`);
                }
                
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!text) {
                    throw new Error("Invalid response structure from API.");
                }
                return text;

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                return "Error: Could not get a response from the AI. Please try again later.";
            }
        }

        async function generateAiSummary() {
            if (!currentScanData) return;

            // UI loading state
            const btn = aiSummaryBtn;
            const icon = document.getElementById('ai-summary-icon');
            const spinner = document.getElementById('ai-summary-spinner');
            
            btn.disabled = true;
            icon.classList.add('hidden');
            spinner.classList.remove('hidden');
            aiSummaryContent.textContent = 'Analyzing your report...';
            aiSummaryContent.classList.remove('italic');

            const findingsText = currentScanData.results.findings.map(f => `- ${f.title} (Risk: ${f.risk}): ${f.description}`).join('\n');
            const systemPrompt = "You are SecuraScan AI, a cybersecurity expert. Your job is to explain technical security reports to non-technical website owners in a simple, single paragraph. Be calm, clear, and focus on the overall risk and what it means for them. Do not use jargon. Start with 'Here\'s the simple summary:'";
            const userPrompt = `My website scan for "${currentScanData.url}" got a grade of "${currentScanData.results.rating}". It found these issues: \n${findingsText}\n\nPlease provide a simple, non-technical, one-paragraph summary of what this means for me.`;

            const summary = await callGeminiAPI(userPrompt, systemPrompt);
            aiSummaryContent.textContent = summary;

            // Restore UI
            btn.disabled = false;
            icon.classList.remove('hidden');
            spinner.classList.add('hidden');
            
            // Add to chat history context
            aiChatHistory = [
                { role: "user", parts: [{ text: userPrompt }] },
                { role: "model", parts: [{ text: summary }] }
            ];
        }

        async function handleAiChat(e) {
            e.preventDefault();
            const userMessage = chatInput.value.trim();
            if (!userMessage || !currentScanData) return;

            chatInput.value = '';
            addMessageToChat('user', userMessage);

            // Add loading indicator
            const thinkingBubble = addMessageToChat('ai', '<div class="spinner w-4 h-4 rounded-full border-2 border-white"></div>');

            const systemPrompt = "You are SecuraScan AI, a helpful cybersecurity assistant. You are chatting with a user about their scan results. Be concise, helpful, and friendly. Use the provided context to answer their questions. If they ask how to fix something, give a simple explanation and a code example if possible.";
            const userPrompt = userMessage;

            // Add new message to history
            aiChatHistory.push({ role: "user", parts: [{ text: userPrompt }] });

            // Create payload with history
            const payload = {
                contents: aiChatHistory,
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            const responseText = await callGeminiAPI(payload.contents[payload.contents.length - 1].parts[0].text, systemPrompt); // simplified call for this use case

            // Update loading indicator with response
            thinkingBubble.innerHTML = responseText.replace(/\n/g, '<br>');

            // Add response to history
            aiChatHistory.push({ role: "model", parts: [{ text: responseText }] });
        }
        
        function addMessageToChat(role, text) {
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble ${role} self-${role === 'user' ? 'end' : 'start'}`;
            bubble.innerHTML = text; // Allow HTML for spinner
            chatWindow.appendChild(bubble);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            return bubble;
        }

        // --- PDF Generation ---
        async function generatePdfReport() {
            if (!currentScanData) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const { results, sslData, url } = currentScanData;
            
            const riskCounts = { Critical: 0, High: 0, Medium: 0, Low: 0 };
            results.findings.forEach(f => {
                if(riskCounts.hasOwnProperty(f.risk)) {
                    riskCounts[f.risk]++;
                }
            });
            const totalIssues = results.findings.length;
            
            // --- Page 1: Summary ---
            // Add Inter font (assuming it's not built-in, this is a placeholder)
            // For a real implementation, you'd need to embed the font
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(24);
            doc.setTextColor(13, 27, 42); // Dark Blue
            doc.text("SecuraScan Security Report", 105, 20, { align: 'center' });
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(11);
            doc.setTextColor(100, 116, 139); // Slate 500
            doc.text(`Report for: ${url}`, 105, 30, { align: 'center' });
            doc.text(`Scan Date: ${new Date().toLocaleString()}`, 105, 35, { align: 'center' });
            
            // --- Summary Box ---
            doc.setDrawColor(226, 232, 240); // Slate 200
            doc.setLineWidth(0.5);
            doc.roundedRect(20, 45, 170, 50, 3, 3);
            
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(13, 27, 42);
            doc.text("Overall Security Rating", 105, 55, { align: 'center' });
            
            // Rating Circle
            const ratingColor = { A: '#10B981', B: '#F59E0B', C: '#EF4444', D: '#B91C1C', E: '#7F1D1D' };
            doc.setFillColor(ratingColor[results.rating] || '#64748B');
            doc.circle(60, 75, 12, 'F');
            doc.setFontSize(22);
            doc.setTextColor(255, 255, 255);
            doc.text(results.rating, 60, 78, { align: 'center' });
            
            // Summary Text
            doc.setFontSize(11);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(51, 65, 85); // Slate 700
            doc.text(`Total Issues Found: ${totalIssues}`, 90, 70);
            doc.text(`- ${riskCounts.Critical} Critical`, 90, 76);
            doc.text(`- ${riskCounts.High} High`, 90, 82);
            doc.text(`- ${riskCounts.Medium} Medium`, 90, 88);
            
            // --- Chart ---
            const chartCanvas = document.createElement('canvas');
            chartCanvas.width = 100;
            chartCanvas.height = 100;
            new Chart(chartCanvas.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Critical', 'High', 'Medium', 'Low'],
                    datasets: [{
                        data: [riskCounts.Critical, riskCounts.High, riskCounts.Medium, riskCounts.Low],
                        backgroundColor: ['#7F1D1D', '#EF4444', '#F59E0B', '#10B981'],
                        borderWidth: 0,
                    }]
                },
                options: {
                    responsive: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
            
            // Wait for chart to render
            await new Promise(resolve => setTimeout(resolve, 500));
            doc.addImage(chartCanvas.toDataURL('image/png', 1.0), 'PNG', 135, 65, 30, 30);
            
            // --- Technical Details ---
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(13, 27, 42);
            doc.text("Technical Scan Details", 20, 110);
            doc.setLineWidth(0.5);
            doc.setDrawColor(79, 70, 229); // Indigo 600
            doc.line(20, 112, 75, 112);
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.setTextColor(51, 65, 85);
            
            const sslText = `
                Issued To: ${sslData.issuedTo}
                Issued By: ${sslData.issuedBy}
                Valid From: ${sslData.validFrom}
                Valid To: ${sslData.validTo}
                Protocol: ${sslData.protocol}
                HSTS Enabled: ${sslData.hsts ? 'Yes' : 'No'}
            `;
            doc.text(sslText, 20, 120);

            // --- Findings ---
            doc.addPage();
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(13, 27, 42);
            doc.text("Vulnerability Findings", 20, 20);
            
            let yPos = 30;
            const riskColors = { 'Critical': '#7F1D1D', 'High': '#EF4444', 'Medium': '#F59E0B', 'Low': '#10B981' };

            results.findings.forEach(finding => {
                if (yPos > 250) { // Check for page break
                    doc.addPage();
                    yPos = 20;
                }
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(riskColors[finding.risk] || '#64748B');
                doc.text(`[${finding.risk}] ${finding.title}`, 20, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.setTextColor(51, 65, 85);
                
                doc.text(doc.splitTextToSize(`Description: ${finding.description}`, 170), 20, yPos);
                yPos += (doc.splitTextToSize(finding.description, 170).length * 4) + 4;
                
                doc.text(doc.splitTextToSize(`Impact: ${finding.impact}`, 170), 20, yPos);
                yPos += (doc.splitTextToSize(finding.impact, 170).length * 4) + 4;
                
                doc.text(doc.splitTextToSize(`Recommendation: ${finding.recommendation}`, 170), 20, yPos);
                yPos += (doc.splitTextToSize(finding.recommendation, 170).length * 4) + 4;
                
                doc.textWithLink('Learn More...', 20, yPos, { url: finding.references });
                doc.setTextColor(79, 70, 229);
                
                yPos += 10;
                doc.setDrawColor(226, 232, 240);
                doc.line(20, yPos, 190, yPos); // Separator
                yPos += 8;
            });

            // --- Save ---
            doc.save(`SecuraScan_Report_${url.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`);
        }

        async function shareScanResults() {
            if (!currentScanData) return;
            
            // Only logged-in (non-anonymous) users can share
            if (!currentUser || currentUser.isAnonymous) {
                authError.textContent = 'Please log in or sign up to share reports.';
                openAuthModal(false); // Prompt to sign up
                return;
            }

            shareButton.disabled = true;
            shareSuccessMessage.textContent = 'Generating share link...';

            try {
                // Add to the public scans collection
                const publicScanRef = await addDoc(collection(db, `artifacts/${appId}/public/scans`), {
                    ...currentScanData,
                    sharedAt: serverTimestamp(),
                    sharedBy: currentUser.uid
                });
                
                // Construct the public URL
                const shareUrl = `${window.location.origin}${window.location.pathname.replace('vulnerability_scanner.html', 'public-scan.html')}?id=${publicScanRef.id}`;
                
                // Copy to clipboard
                const tempInput = document.createElement('input');
                document.body.appendChild(tempInput);
                tempInput.value = shareUrl;
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                shareSuccessMessage.textContent = 'Link copied to clipboard!';
            } catch (error) {
                console.error("Error sharing scan:", error);
                shareSuccessMessage.textContent = 'Error: Could not create share link.';
                if (error.message.includes("Missing or insufficient permissions")) {
                     shareSuccessMessage.textContent = 'Error: You must be logged in to share reports.';
                }
            } finally {
                shareButton.disabled = false;
            }
        }

        function resetToInitialView() {
            initialView.classList.remove('hidden');
            resultsView.classList.add('hidden');
            scanningView.classList.add('hidden');
            urlInput.value = '';
            errorMessage.textContent = '';
            currentScanData = null;
            updateScanButtonState(); // Refresh scan count display
        }

    </script>
</body>
</html>

